<!DOCTYPE html>
<html lang="en"> 
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>新闻详情</title>
    <link rel="stylesheet" type="text/css" href="../source/font/flaticon.css">
    <link rel="stylesheet" type="text/css" href="../source/flaticon/flaticon.css">
    <link rel="stylesheet" type="text/css" href="../source/css/mui.min.css">
    <link rel="stylesheet" type="text/css" media="screen and (max-width:800px)" href="../source/css/reset.css">
    <link rel="stylesheet" type="text/css" media="screen and (max-width:800px)" href="../source/css/news.css?201606281300">
    <link rel="stylesheet" href="../source/css/onLarge.css">
    <script type="text/javascript" src="../source/js/jquery-1.7.2.js"></script>
</head>
<body>
	<!-- <div class="bookHeader">
        <a id="backLink">
            <p class="backBtn"><i class="flaticon-back backfont"></i></p>
        </a>
        <p class="bookTitle">新闻详情</p>
        <a href="">
            <p class="moreInfo"><i class="flaticon-more-1 "></i></p>
        </a>
    </div> -->
    <div class="newsContainer"> 
    	<div class="newsContent">
    		<!-- <p class="newsTitle">美国总统奥巴马与副总统拜登到访枪击案临时纪念地，悼念遇难者。</p> 
    		<div class="newsSource">
    			<p class="deliver">通知公告&nbsp;&nbsp;中国银监会</p>
    			<p class="newsDate">05-10&nbsp;11:39</p>
    		</div>
    		<div class="news">			
    			<div class="mui-content-padded">
		    		<ul class="mui-table-view">
		    			<li class="mui-table-view-cell">
		    				<div class="newsImg">
		    					<img src="../source/img/newsimg1.jpg" data-preview-src="" data-preview-group="1" class="newsImg1">
		    				</div>
		    			</li>
		    			<p class="introduction" >图片1说明</p>
		    			<li class="mui-table-view-cell">
		    				<div class="newsImg">
		    					<img src="../source/img/newsimg2.jpg" data-preview-src="" data-preview-group="1" class="newsImg1">
		    				</div>
		    			</li>
		    			<p class="introduction">图片2说明</p>
		    			<li class="mui-table-view-cell">
		    				<div class="newsImg">
		    					<img src="../source/img/obama.jpg" data-preview-src="" data-preview-group="1" class="newsImg1">
		    				</div>
		    			</li>
		    			<p class="introduction">图片3说明</p>
		    		</ul>
	    		</div>
	    		<div class="newsArticle">
	    			<p class="newsPara">当地时间2016年6月16日，美国奥兰多，美国总统奥巴马与副总统拜登到访枪击案临时纪念地，悼念遇难者。</p>
	    			<p class="newsPara">据美国纽约时报6月22日报道，美国白宫于当地时间6月22日表示，美国总统奥巴马将于6月26日到南卡罗来纳州出席死于教堂枪击案的牧师平克尼葬礼并将为其致悼词。美国副总统拜登预计同行。</p>
					<p class="newsPara">当地时间6月17日晚，美国南卡罗来纳州查尔斯顿市一座历史悠久的黑人教堂发生枪击案，造成9人遇难。案发14个小时后，21岁的白人嫌犯迪伦·鲁夫在数百公里外被捕。种种迹象显示，这可能是美国数十年来发生的最血腥的“仇视犯罪”事件。而且有证据显示此次事件出于种族仇视。</p>
	    		</div>
	    	</div> -->
    		<div class="comments">
    			<ul class="mui-table-view commentsList3" id="commentslist33">
    				<!-- <li class="mui-table-view-cell commentsTitle">
    					<p class="commentspara">评论 &nbsp;<span style="color:#5e5e5e">300</span></p>
    				</li> -->
	    			<!-- <li class="mui-table-view-cell">
	    				<div class="CommentItems">
	    					<div class="leftItem leftItem1"></div>
	    					<div class="rightItem">
	    						<p class="rightPara1 rightPara">向丽</p>
	    						<p class="rightPara2 rightPara">13小时前</p>
	    						<p class="rightPara3 rightPara">为遇难者祈福...</p>
	    					</div>
	    					<p class="like">
		    					<i class="flaticon-heart likeFont"></i>&nbsp;880
		    				</p>
	    				</div>
	    			</li>
	    			<li class="mui-table-view-cell">
	    				<div class="CommentItems">
	    					<div class="leftItem leftItem2"></div>
	    					<div class="rightItem">
	    						<p class="rightPara1 rightPara">    袁峰然</p>
	    						<p class="rightPara2 rightPara">18小时前</p>
	    						<p class="rightPara3 rightPara">愿逝者安息，生者节哀</p>
	    					</div>
	    					<p class="like">
		    					<i class="flaticon-heart likeFont"></i>&nbsp;880
		    				</p>
	    				</div>
	    			</li>
	    			<li class="mui-table-view-cell">
	    				<div class="CommentItems">
	    					<div class="leftItem leftItem3"></div>
	    					<div class="rightItem">
	    						<p class="rightPara1 rightPara">阿沁</p>
	    						<p class="rightPara2 rightPara">20小时前</p>
	    						<p class="rightPara3 rightPara">民族平等！</p>
	    					</div>	    					
	    					<p class="like">
		    					<i class="flaticon-heart likeFont"></i>&nbsp;880
		    				</p>
	    				</div>
	    			</li> -->                    
	    			<li class="mui-table-view-cell commentsTitle moreComments">
	    				<div id="lookMore">
	    					<p class="More">查看更多评论</p>
	    				</div>
	    			</li>
    			</ul>
    		</div>  
    		<div class="sendComments">
				<p class="edit">
					<i class="flaticon-edit editFont"></i>
					<input class="inputComments" type="text" placeholder="评论">
				</p>
				<p class="likeIcon">
					<i class="flaticon-heart likeFont"></i>
					<span class="deliver">发送</span>
				</p>
    		</div>		
    	</div>
    </div>
</body>
	<script src="../source/js/mui.min.js"></script>
	<script src="../source/js/mui.zoom.js"></script>
	<script src="../source/js/mui.previewimage.js"></script>
	<script type="text/javascript">
    	var param=window.location.search;
    	var paramsep=param.split(",");
    	var idsep=paramsep[0].split("=");
    	var id=idsep[1];
    	var funsep=paramsep[1].split("=");
    	var fun=funsep[1];
    	var commenttxt=$(".inputComments").val();
    	$.post('/home/index/show', {id: id,function:fun}, function(data, textStatus, xhr) {
    		console.log(data);
    		for (var i = 0; i < data.length; i++) {
    			var author=data[i].author;
    			var time=data[i].in_time;
    			var text=data[i].text;
    			var theme=data[i].theme;
    			var title=data[i].title;
    			var detail=data[i].detail;
    			if(fun==1){
    				var fun1=$('<div>'+
    								'<p class="newsTitle"></p>'+ 
    								'<div class="newsSource">'+
    									'<p class="deliver">'+
    										'<span class="columnSorts"></span>'+
    										'&nbsp;&nbsp;'+
    										'<span class="unitSorts"></span>'+
    									'</p>'+
    									'<p class="newsDate"></p>'+
    								'</div>'+
    								'<div class="news">'+		
		    							'<div class="newsArticle">'+
		    							'	<p class="newsPara"></p>'+	
		    							'</div>'+
	    							'</div>'+
	    						'</div>');   
    				fun1.find(".newsTitle").text(title);
    				fun1.find(".columnSorts").text(theme);
    				fun1.find(".unitSorts").text(author);
    				fun1.find(".newsDate").text(time);
    				fun1.find(".newsPara").html(text);
    				$(".newsContent").prepend(fun1);
    			}
    			else if(fun==2){
    				var fun2=$('<p class="newsTitle"></p>'+ 
    								'<div class="newsSource">'+
    									'<p class="deliver"><span class="columnSorts"></span>&nbsp;&nbsp;<span class="unitSorts"></span></p>'+
    									'<p class="newsDate"></p>'+
    								'</div>'+
    								'<div class="news">'+	
    									'<div class="mui-content-padded">'+
		    								'<ul class="mui-table-view">'+
		    								'</ul>'+
	    								'</div>'+
	    							'<div class="newsArticle">'+
	    								'<p class="newsPara"></p>'+
	    							'</div>'+
	    						'</div>');
    				for (var j = 0; j < detail.length; j++) {
    					var imgsrc=detail[i].photo_photo;
    					var imgtxt=detail[i].photo_text;
    					var pictxt=$('<li class="mui-table-view-cell">'+
	    								'<div class="newsImg">'+
	    									'<img data-preview-src="" data-preview-group="1" class="newsImg1">'+
	    								'</div>'+
	    							'</li>'+
	    							'<p class="introduction" ></p>');
    					pictxt.children('img').attr("src",imgsrc);
    					pictxt.children('.introduction').text(imgtxt);
    					fun2.children('.mui-table-view').append(pictxt);
    				}
    				fun2.find(".newsTitle").text(title);
    				fun2.find(".columnSorts").text(theme);
    				fun2.find(".unitSorts").text(author);
    				fun2.find(".newsDate").text(time);
    				fun2.find(".newsPara").html(text);
    				$(".newsContent").prepend(fun2);
    			}
	    		// switch(fun){
	    		// 	case 1:
	    		// 	alert(ido);
	    		// 		var fun1=$('<p class="newsTitle"></p>'+ 
	    		// 					'<div class="newsSource">'+
	    		// 						'<p class="deliver">'+
	    		// 						'<span class="columnSorts"></span>'+
	    		// 						'&nbsp;&nbsp;'+
	    		// 						'<span class="unitSorts"></span>'+
	    		// 						'</p>'+
	    		// 						'<p class="newsDate"></p>'+
	    		// 					'</div>'+
	    		// 					'<div class="news">'+		
			    // 						'<div class="newsArticle">'+
			    // 							'<p class="newsPara"></p>'+	
			    // 						'</div>'+
		    	// 					'</div>');   
	    		// 		fun1.find(".newsTitle").text(title);
	    		// 		fun1.find(".columnSorts").text(theme);
	    		// 		fun1.find(".unitSorts").text(author);
	    		// 		fun1.find(".newsDate").text(time);
	    		// 		fun1.find(".newsPara").text(text);
	    		// 		$(".newsContent").append(fun1);
	    		// 		console.log(fun1);
		    	// 		break;
	    		// 	case 2:
	    		// 		var fun2=$('<p class="newsTitle"></p>'+ 
    			// 					'<div class="newsSource">'+
    			// 						'<p class="deliver"><span class="columnSorts"></span>&nbsp;&nbsp;<span class="unitSorts"></span></p>'+
    			// 						'<p class="newsDate"></p>'+
    			// 					'</div>'+
    			// 					'<div class="news">'+	
    			// 						'<div class="mui-content-padded">'+
		    	// 							'<ul class="mui-table-view">'+
		    	// 							'</ul>'+
	    		// 						'</div>'+
	    		// 					'<div class="newsArticle">'+
	    		// 						'<p class="newsPara"></p>'+
	    		// 					'</div>'+
	    		// 				'</div>');
	    		// 		for (var j = 0; j < detail.length; j++) {
	    		// 			var imgsrc=detail[i].photo_photo;
	    		// 			var imgtxt=detail[i].photo_text;
	    		// 			var pictxt=$('<li class="mui-table-view-cell">'+
		    	// 							'<div class="newsImg">'+
		    	// 								'<img data-preview-src="" data-preview-group="1" class="newsImg1">'+
		    	// 							'</div>'+
		    	// 						'</li>'+
		    	// 						'<p class="introduction" ></p>');
	    		// 			pictxt.children('img').attr("src",imgsrc);
	    		// 			pictxt.children('.introduction').text(imgtxt);
	    		// 			fun2.children('.mui-table-view').append(pictxt);
	    		// 		}
	    		// 		fun2.find(".newsTitle").text(title);
	    		// 		fun2.find(".columnSorts").text(theme);
	    		// 		fun2.find(".unitSorts").text(author);
	    		// 		fun2.find(".newsDate").text(time);
	    		// 		fun2.find(".newsPara").text(text);
	    		// 		$(".newsContent").prepend(fun2);
	    		// 		console.log(fun2);
	    		// 		break;
    		 //    }
	        }
	         $(".newsImg1").bind('click',function(){
                            mui.previewImage();
                        })
	    });
	    $.post('/home/index/comment', {id: id}, function(data, textStatus, xhr) {
	    	/*optional stuff to do after success */
	    	for (var i = 0; i <data.length; i++) {
	    		var avatar=data[i].avatar;
	    		var commentid=data[i].id;
	    		var time=data[i].in_time;
	    		var nick=data[i].nick;
	    		var text=data[i].text;
	    		var $uedi=$(text).find("img").each(function(){
	    			$(this).addClass('showimg');
	    			$(this).attr('data-preview-group','3');

	    		})
	    		var count=data[i].count;
	    		var comments=$('<li class="mui-table-view-cell">'+
	    				 			'<div class="CommentItems">'+
	    									'<img class="leftItem">'+
	    									'<div class="rightItem">'+
	    										'<p class="rightPara1 rightPara"></p>'+
	    										'<p class="rightPara2 rightPara"></p>'+
	    										'<p class="rightPara3 rightPara"></p>'+
	    									'</div>'+
	    									'<p class="like">'+
		    									'<i class="flaticon-heart likeFont"></i>&nbsp;&nbsp;'+
		    									'<span class="likeCount"></span>'+
		    								'</p>'+
	    								'</div>'+
	    							'</li>');
	    		comments.find(".leftItem").attr("src",avatar);
	    		comments.find(".rightPara1").text(nick);
	    		comments.find(".rightPara2").text(time);
	    		comments.find(".rightPara3").text(text);
	    		comments.find(".likeCount").text(count);
	    		comments.attr("data-id",commentid);
	    		comments.attr("data-count",count);
	    		$(".moreComments").prepend(comments);

	    	}
	    });
	    $.post('/home/index/commentcount', {id: id}, function(data, textStatus, xhr) {
	    	var commentsNum=$('<li class="mui-table-view-cell commentsTitle commentsHeader">'+
    								'<p class="commentspara">评论 &nbsp;'+
    									'<span style="color:#5e5e5e" class="comNum"></span>'+
    								'</p>'+
    							'</li>');
	    	commentsNum.find(".comNum").text(data);
	    	$(".commentsList3").prepend(commentsNum);
	    });
	    mui.previewImage();
		$(".mui-table-view-cell>a:not(.mui-btn)").removeClass("mui-active");
		mui('body').on('tap','#lookMore',function(){
			mui.openWindow({
				url: 'moreComments.html?id=' + id + ',' + 'function=' + fun,
				id:'lookMore'
			})
		})
		$("#backLink").bind('tap',function(){
			mui.openWindow({
				url:"index.html",
				id:'backLink'
			})
		})
    </script>  
     <script type="text/javascript">
			var tapNum=0;
			var param=window.location.search;
	    	var paramsep=param.split(",");
	    	var idsep=paramsep[0].split("=");
	    	var id=idsep[1];
	    	
			$(".sendComments").on('tap',".likeFont",function(){  
				$.post('/home/index/article_likeapi', {id: id}, function(data, textStatus, xhr) {
		    		if(tapNum%2==0&&data.state==0){
	            		$(this).addClass("red");
	            		alert(data.detail);
	            	}
	            	else if(state='100005'){
	            		alert(data.detail);
	            		$(this).removeClass("red");
	            	}
            	});  
	   		});
	   		$(".sendComments").on('tap',".deliver",function(){  
	   			var commenttxt=$(".inputComments").val();
	    		$.post('/home/index/commentapi', {id: id,text:commenttxt}, function(data, textStatus, xhr) {
	    			console.log("comments"+data);
	    			if(data.state==0){
	    				alert("发布成功");
	    				$(".inputComments").val("");
	    			}
	    			else{

	    				alert(data.detail);
	    			}
	    		});	
	    	});
	   		
   			$(".mui-table-view").on('tap',".likeFont",function(){  
   				var myid=$(this).parents(".mui-table-view-cell").attr("data-id");
   				var mycount=$(this).parents(".mui-table-view-cell").attr("data-count");
   				$.post('/home/index/comment_likeapi', {id:myid}, function(data, textStatus, xhr) {
	    			if(tapNum%2==0&&data.state==0){
	            		$(this).addClass("red");
	            		alert(data.detail);
	            		
	            		//mycount++;
	            	}
	            	else{
	            		alert("取消点赞！");
	            		$(this).removeClass("red");
	            		//mycount--;
	            	}
	            	location.reload("newsDetail.html");
	            	//$("#"+myid).find(".likeCount").text(mycount);
        		});  

   		});			
	</script> 
</html>